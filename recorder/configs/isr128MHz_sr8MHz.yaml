# SPDX-FileCopyrightText: Copyright (c) 2023 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
scheduler:
  worker_thread_number: 8
  stop_on_deadlock: true
  stop_on_deadlock_timeout: 500

pipeline:
  selector: false
  converter: true
  rotator: false
  resampler0: true
  resampler1: false
  resampler2: true

packet:
  batch_size: &batch_size 6250 # Number of packets to process at once into tensor data
  max_packet_size: &max_packet_size 8256
  num_subchannels: &num_subchannels 1 # Number of IQ subchannels of data that form a sample
  num_samples: &rx_chunk_size 12800000 # Number of samples to output as a single chunk, must fit one batch of packets
  buffer_size: 10 # Number of num_samples chunks to store in the rx buffer
  spoof_header: true
  packet_skip_bytes: 0
  header_metadata:
    start_sample_idx: 0
    sample_rate_numerator: 128000000
    sample_rate_denominator: 1
    freq_idx: 0
    num_subchannels: *num_subchannels
    pkt_samples: 2048
    bits_per_int: 16
    is_complex: 1

basic_network:
  batch_size: *batch_size # Number of packets in a batch
  max_payload_size: *max_packet_size # Maximum payload size
  dst_port: 60133 # UDP destination port for packets
  l4_proto: udp # Layer 4 protocol
  ip_addr: 0.0.0.0 # Destination IP address

advanced_network:
  cfg:
    version: 1
    master_core: 1 # Master CPU core
    rx:
      - if_name: 0004:01:00.0 # PCIe BFD of NIC
        flow_isolation: true
        queues:
          - name: "RF Samples Ch0"
            id: 0
            gpu_device: 0
            gpu_direct: true
            split_boundary: 42
            cpu_cores: "2"
            max_packet_size: *max_packet_size # Maximum payload size
            num_concurrent_batches: 15 # Number of batches that can be used at any time
            batch_size: *batch_size # Number of packets in a batch
            output_port: "ch0"
        flows:
          - name: "UDP 60133 - Ch0"
            action:
              type: queue
              id: 0
            match:
              udp_src: 60133
              udp_dst: 60133

selector:
  subchannel_idx: [0]

rotator:
  cycle_duration_secs: 1
  cycle_start_timestamp: 0
  schedule:
    - start: 0
      freq: 0e+6

resampler0:
  chunk_size: *rx_chunk_size
  num_subchannels: *num_subchannels
  up: 1
  down: 4
  # scipy.signal.kaiserord(100, .2)
  # scipy.signal.firwin(63, 1/4, window=('kaiser', 10.06126))
  filter_coefs:
    [
      -2.432986354338939902e-06,
      -1.201387301755816774e-05,
      -2.010498573383628115e-05,
      4.865785110597989198e-20,
      7.234990153682062798e-05,
      1.718833047653556192e-04,
      1.936611739202120279e-04,
      -3.075496883998056510e-19,
      -4.371133391839054504e-04,
      -8.871516936482441804e-04,
      -8.784067619253728160e-04,
      1.042633239824355963e-18,
      1.619716840871448203e-03,
      3.030881092474629977e-03,
      2.794442692477808014e-03,
      -2.491560614216840016e-18,
      -4.576011787082063208e-03,
      -8.151611658702415109e-03,
      -7.198316142465801051e-03,
      4.637485763314281690e-18,
      1.100614435068092249e-02,
      1.912193894312655060e-02,
      1.658519934592679254e-02,
      -7.054821738079720252e-18,
      -2.513162444027867287e-02,
      -4.429275629171359335e-02,
      -3.972771271168364093e-02,
      8.997958484987521336e-18,
      7.173841174691804323e-02,
      1.560196258815701176e-01,
      2.239619030958457935e-01,
      2.499981966033499314e-01,
      2.239619030958457935e-01,
      1.560196258815701176e-01,
      7.173841174691804323e-02,
      8.997958484987521336e-18,
      -3.972771271168364093e-02,
      -4.429275629171359335e-02,
      -2.513162444027867287e-02,
      -7.054821738079720252e-18,
      1.658519934592679254e-02,
      1.912193894312655060e-02,
      1.100614435068092249e-02,
      4.637485763314281690e-18,
      -7.198316142465801051e-03,
      -8.151611658702415109e-03,
      -4.576011787082063208e-03,
      -2.491560614216840016e-18,
      2.794442692477808014e-03,
      3.030881092474629977e-03,
      1.619716840871448203e-03,
      1.042633239824355963e-18,
      -8.784067619253728160e-04,
      -8.871516936482441804e-04,
      -4.371133391839054504e-04,
      -3.075496883998056510e-19,
      1.936611739202120279e-04,
      1.718833047653556192e-04,
      7.234990153682062798e-05,
      4.865785110597989198e-20,
      -2.010498573383628115e-05,
      -1.201387301755816774e-05,
      -2.432986354338939902e-06,
    ]

resampler2:
  chunk_size: 3200000
  num_subchannels: *num_subchannels
  up: 1
  down: 4
  # scipy.signal.kaiserord(99, .025)
  # scipy.signal.firwin(511, 1/4, window=('kaiser', 9.95106))
  filter_coefs:
    [
      -3.283715415979136751e-07,
      -5.610327859101661570e-07,
      -4.719119827183751392e-07,
      -2.307351317887043770e-21,
      6.446398506343295995e-07,
      1.050869456967983453e-06,
      8.502003666440789634e-07,
      -2.009034429250237532e-20,
      -1.092531618960955540e-06,
      -1.737786095745858642e-06,
      -1.375878095680522874e-06,
      8.500839198448183737e-21,
      1.704804331108725262e-06,
      2.669861493776913041e-06,
      2.084208642925009633e-06,
      -6.995516866208151576e-20,
      -2.519336937404230604e-06,
      -3.902572353945784810e-06,
      -3.015796559804429629e-06,
      5.013101016070310978e-20,
      3.579570167063569281e-06,
      5.499417396809462189e-06,
      4.217029600135704248e-06,
      1.598599559041492848e-23,
      -4.934949733663501931e-06,
      -7.532544526932845257e-06,
      -5.740522281215527710e-06,
      1.541224364863730915e-19,
      6.641369535053029112e-06,
      1.008337698279600475e-05,
      7.645558020313557922e-06,
      -7.942321131341476205e-20,
      -8.761612044652811006e-06,
      -1.324323455999509622e-05,
      -9.998527125737510844e-06,
      -5.916410273236554626e-20,
      1.136578328060516862e-05,
      1.711394630143334871e-05,
      1.287335816274617411e-05,
      -2.654631840756905072e-19,
      -1.453174003489128056e-05,
      -2.180845150652314335e-05,
      -1.635194056787656769e-05,
      7.198801773919942622e-20,
      1.834550745866018732e-05,
      2.745138654185114494e-05,
      2.052453686354134316e-05,
      2.405416445549713758e-19,
      -2.290168564598306724e-05,
      -3.417965575765894782e-05,
      -2.549018344208804588e-05,
      3.723109069983283187e-19,
      2.830384455083175501e-05,
      4.214298584938858501e-05,
      3.135707966054841268e-05,
      4.580775718953067361e-20,
      -3.466490742804570778e-05,
      -5.150446427586512189e-05,
      -3.824296593193703337e-05,
      9.456306620925348863e-19,
      4.210752402756450050e-05,
      6.244106388374968388e-05,
      4.627549263707168658e-05,
      -4.030122260831995032e-19,
      -5.076443601501273386e-05,
      -7.514415772517768325e-05,
      -5.559258303712842934e-05,
      -4.030770355048161356e-19,
      6.077883856797722332e-05,
      8.982003023233752501e-05,
      6.634279497164115140e-05,
      -1.247974971481884888e-18,
      -7.230474383911303002e-05,
      -1.066903934785245128e-04,
      -7.868568801605941773e-05,
      2.271942032748240091e-19,
      8.550735402568250120e-05,
      1.259929202712357173e-04,
      9.279220499320688662e-05,
      -2.677950836717024222e-18,
      -1.005634541915599107e-04,
      -1.479818093660785711e-04,
      -1.088450793417681465e-04,
      1.411588618226507497e-18,
      1.176618378169535335e-04,
      1.729284022581496771e-04,
      1.270392829153506938e-04,
      3.660935124588481926e-19,
      -1.370037813861267985e-04,
      -2.011218759245353383e-04,
      -1.475825324114199888e-04,
      3.395041223510283000e-18,
      1.588035882699395738e-04,
      2.328700417175705447e-04,
      1.706958769311470332e-04,
      -1.225521925722551208e-18,
      -1.832892268554435012e-04,
      -2.685002875500554025e-04,
      -1.966143943043035212e-04,
      2.397698082526185721e-18,
      2.107030934964849870e-04,
      3.083607088390811633e-04,
      2.255880299812324311e-04,
      -3.880404155307251242e-18,
      -2.413029376386935636e-04,
      -3.528214837346671929e-04,
      -2.578826197606839845e-04,
      3.687880642471021645e-19,
      2.753629947133739769e-04,
      4.022765604126639426e-04,
      2.937811467368484867e-04,
      -1.891375699924926369e-18,
      -3.131753824967510786e-04,
      -4.571457392643840851e-04,
      -3.335852940701765877e-04,
      3.815618335947886186e-18,
      3.550518291236954269e-04,
      5.178772514723495920e-04,
      3.776173691260129722e-04,
      1.619631096469300435e-18,
      -4.013258165339869199e-04,
      -5.849509587955414305e-04,
      -4.262226919985679578e-04,
      3.034460489220220099e-19,
      4.523552427605027687e-04,
      6.588823288403474875e-04,
      4.797725635446386887e-04,
      -2.737689689029086695e-18,
      -5.085257314208971703e-04,
      -7.402273776161021101e-04,
      -5.386679562808597806e-04,
      5.760726954089556038e-18,
      5.702547487866656663e-04,
      8.295888194271075749e-04,
      6.033441078862847740e-04,
      -9.458665100024179815e-18,
      -6.379967302632455397e-04,
      -9.276237267946464173e-04,
      -6.742762444033755962e-04,
      -1.213345940601455292e-21,
      7.122494723258816166e-04,
      1.035053085209494380e-03,
      7.519867224473152480e-04,
      -3.746319196664026521e-18,
      -7.935621175374408696e-04,
      -1.152673736200325854e-03,
      -8.370539622961274771e-04,
      8.337973557134201393e-18,
      8.825451557471794637e-04,
      1.281373347537412407e-03,
      9.301236544248120148e-04,
      5.294540287053875835e-18,
      -9.798829932458597534e-04,
      -1.422149245794784855e-03,
      -1.031922872039683524e-03,
      -7.353746448323929446e-19,
      1.086349816984764688e-03,
      1.576132214867276586e-03,
      1.143277927712935604e-03,
      -4.874506210032796126e-18,
      -1.202829722642428196e-03,
      -1.744616735069100038e-03,
      -1.265137097248181025e-03,
      1.168629515453832753e-17,
      1.330342412551121069e-03,
      1.929099656820439275e-03,
      1.398599734200756985e-03,
      -1.987247175184321271e-17,
      -1.470076246259929831e-03,
      -2.131330039731631470e-03,
      -1.544953868323692197e-03,
      -2.197076841118903646e-18,
      1.623431110111481180e-03,
      2.353373948259382224e-03,
      1.705725204400396515e-03,
      -6.056071209347762950e-18,
      -1.792074567432155137e-03,
      -2.597699545047534638e-03,
      -1.882741646121399498e-03,
      1.604601436516691939e-17,
      1.978016224037324258e-03,
      2.867290127296864659e-03,
      2.078219273891772616e-03,
      -6.641020498755314185e-18,
      -2.183707464026366386e-03,
      -3.165796241146720015e-03,
      -2.294878451303929319e-03,
      -4.893789048815334589e-18,
      2.412177124418568921e-03,
      3.497743402613742465e-03,
      2.536103001999487870e-03,
      -7.206761504663687477e-18,
      -2.667219041779387862e-03,
      -3.868820479545574068e-03,
      -2.806162184306369278e-03,
      2.194261923666239828e-17,
      2.953656042394319642e-03,
      4.286287607638320472e-03,
      3.110526262921021502e-03,
      -7.741430871195519940e-18,
      -3.277719240773464219e-03,
      -4.759565545420273505e-03,
      -3.456325069955864561e-03,
      -9.844292784073360899e-18,
      3.647605894525536487e-03,
      5.301107988906407498e-03,
      3.853031201663339490e-03,
      -8.233318886359655360e-18,
      -4.074322124226901348e-03,
      -5.927728987271504296e-03,
      -4.313507555191063540e-03,
      3.077031693418756535e-17,
      4.572995919140033019e-03,
      6.662688754846967862e-03,
      4.855667946530793123e-03,
      -8.671261909983978338e-18,
      -5.164997989571712932e-03,
      -7.539096581338303356e-03,
      -5.505214678609355802e-03,
      8.866760194725782312e-18,
      5.881516654568113081e-03,
      8.605715380972321291e-03,
      6.300366742355039372e-03,
      -9.045028658542676254e-18,
      -6.769899989474203322e-03,
      -9.937409268605706600e-03,
      -7.300500538525960502e-03,
      9.204993673482759691e-18,
      7.905634876326570262e-03,
      1.165523418893791956e-02,
      8.603085029764007130e-03,
      -9.345683204683689989e-18,
      -9.416825153410184057e-03,
      -1.396844440067751894e-02,
      -1.037997043587248272e-02,
      9.466235736587366667e-18,
      1.153958845359241529e-02,
      1.727250594752856999e-02,
      1.296490675140878415e-02,
      -9.565908234165344786e-18,
      -1.476208646055058096e-02,
      -2.241513085855157197e-02,
      -1.710263307024820906e-02,
      9.644083045673297660e-18,
      2.028280072917379093e-02,
      3.160078983404967373e-02,
      2.486220223299029711e-02,
      -9.700273665533955039e-18,
      -3.204003606883161492e-02,
      -5.291326927488118614e-02,
      -4.493425827442720788e-02,
      9.734129289153610007e-18,
      7.497744157785644903e-02,
      1.591088924632299284e-01,
      2.250629437410352207e-01,
      2.500002186749363808e-01,
      2.250629437410352207e-01,
      1.591088924632299284e-01,
      7.497744157785644903e-02,
      9.734129289153610007e-18,
      -4.493425827442720788e-02,
      -5.291326927488118614e-02,
      -3.204003606883161492e-02,
      -9.700273665533955039e-18,
      2.486220223299029711e-02,
      3.160078983404967373e-02,
      2.028280072917379093e-02,
      9.644083045673297660e-18,
      -1.710263307024820906e-02,
      -2.241513085855157197e-02,
      -1.476208646055058096e-02,
      -9.565908234165344786e-18,
      1.296490675140878415e-02,
      1.727250594752856999e-02,
      1.153958845359241529e-02,
      9.466235736587366667e-18,
      -1.037997043587248272e-02,
      -1.396844440067751894e-02,
      -9.416825153410184057e-03,
      -9.345683204683689989e-18,
      8.603085029764007130e-03,
      1.165523418893791956e-02,
      7.905634876326570262e-03,
      9.204993673482759691e-18,
      -7.300500538525960502e-03,
      -9.937409268605706600e-03,
      -6.769899989474203322e-03,
      -9.045028658542676254e-18,
      6.300366742355039372e-03,
      8.605715380972321291e-03,
      5.881516654568113081e-03,
      8.866760194725782312e-18,
      -5.505214678609355802e-03,
      -7.539096581338303356e-03,
      -5.164997989571712932e-03,
      -8.671261909983978338e-18,
      4.855667946530793123e-03,
      6.662688754846967862e-03,
      4.572995919140033019e-03,
      3.077031693418756535e-17,
      -4.313507555191063540e-03,
      -5.927728987271504296e-03,
      -4.074322124226901348e-03,
      -8.233318886359655360e-18,
      3.853031201663339490e-03,
      5.301107988906407498e-03,
      3.647605894525536487e-03,
      -9.844292784073360899e-18,
      -3.456325069955864561e-03,
      -4.759565545420273505e-03,
      -3.277719240773464219e-03,
      -7.741430871195519940e-18,
      3.110526262921021502e-03,
      4.286287607638320472e-03,
      2.953656042394319642e-03,
      2.194261923666239828e-17,
      -2.806162184306369278e-03,
      -3.868820479545574068e-03,
      -2.667219041779387862e-03,
      -7.206761504663687477e-18,
      2.536103001999487870e-03,
      3.497743402613742465e-03,
      2.412177124418568921e-03,
      -4.893789048815334589e-18,
      -2.294878451303929319e-03,
      -3.165796241146720015e-03,
      -2.183707464026366386e-03,
      -6.641020498755314185e-18,
      2.078219273891772616e-03,
      2.867290127296864659e-03,
      1.978016224037324258e-03,
      1.604601436516691939e-17,
      -1.882741646121399498e-03,
      -2.597699545047534638e-03,
      -1.792074567432155137e-03,
      -6.056071209347762950e-18,
      1.705725204400396515e-03,
      2.353373948259382224e-03,
      1.623431110111481180e-03,
      -2.197076841118903646e-18,
      -1.544953868323692197e-03,
      -2.131330039731631470e-03,
      -1.470076246259929831e-03,
      -1.987247175184321271e-17,
      1.398599734200756985e-03,
      1.929099656820439275e-03,
      1.330342412551121069e-03,
      1.168629515453832753e-17,
      -1.265137097248181025e-03,
      -1.744616735069100038e-03,
      -1.202829722642428196e-03,
      -4.874506210032796126e-18,
      1.143277927712935604e-03,
      1.576132214867276586e-03,
      1.086349816984764688e-03,
      -7.353746448323929446e-19,
      -1.031922872039683524e-03,
      -1.422149245794784855e-03,
      -9.798829932458597534e-04,
      5.294540287053875835e-18,
      9.301236544248120148e-04,
      1.281373347537412407e-03,
      8.825451557471794637e-04,
      8.337973557134201393e-18,
      -8.370539622961274771e-04,
      -1.152673736200325854e-03,
      -7.935621175374408696e-04,
      -3.746319196664026521e-18,
      7.519867224473152480e-04,
      1.035053085209494380e-03,
      7.122494723258816166e-04,
      -1.213345940601455292e-21,
      -6.742762444033755962e-04,
      -9.276237267946464173e-04,
      -6.379967302632455397e-04,
      -9.458665100024179815e-18,
      6.033441078862847740e-04,
      8.295888194271075749e-04,
      5.702547487866656663e-04,
      5.760726954089556038e-18,
      -5.386679562808597806e-04,
      -7.402273776161021101e-04,
      -5.085257314208971703e-04,
      -2.737689689029086695e-18,
      4.797725635446386887e-04,
      6.588823288403474875e-04,
      4.523552427605027687e-04,
      3.034460489220220099e-19,
      -4.262226919985679578e-04,
      -5.849509587955414305e-04,
      -4.013258165339869199e-04,
      1.619631096469300435e-18,
      3.776173691260129722e-04,
      5.178772514723495920e-04,
      3.550518291236954269e-04,
      3.815618335947886186e-18,
      -3.335852940701765877e-04,
      -4.571457392643840851e-04,
      -3.131753824967510786e-04,
      -1.891375699924926369e-18,
      2.937811467368484867e-04,
      4.022765604126639426e-04,
      2.753629947133739769e-04,
      3.687880642471021645e-19,
      -2.578826197606839845e-04,
      -3.528214837346671929e-04,
      -2.413029376386935636e-04,
      -3.880404155307251242e-18,
      2.255880299812324311e-04,
      3.083607088390811633e-04,
      2.107030934964849870e-04,
      2.397698082526185721e-18,
      -1.966143943043035212e-04,
      -2.685002875500554025e-04,
      -1.832892268554435012e-04,
      -1.225521925722551208e-18,
      1.706958769311470332e-04,
      2.328700417175705447e-04,
      1.588035882699395738e-04,
      3.395041223510283000e-18,
      -1.475825324114199888e-04,
      -2.011218759245353383e-04,
      -1.370037813861267985e-04,
      3.660935124588481926e-19,
      1.270392829153506938e-04,
      1.729284022581496771e-04,
      1.176618378169535335e-04,
      1.411588618226507497e-18,
      -1.088450793417681465e-04,
      -1.479818093660785711e-04,
      -1.005634541915599107e-04,
      -2.677950836717024222e-18,
      9.279220499320688662e-05,
      1.259929202712357173e-04,
      8.550735402568250120e-05,
      2.271942032748240091e-19,
      -7.868568801605941773e-05,
      -1.066903934785245128e-04,
      -7.230474383911303002e-05,
      -1.247974971481884888e-18,
      6.634279497164115140e-05,
      8.982003023233752501e-05,
      6.077883856797722332e-05,
      -4.030770355048161356e-19,
      -5.559258303712842934e-05,
      -7.514415772517768325e-05,
      -5.076443601501273386e-05,
      -4.030122260831995032e-19,
      4.627549263707168658e-05,
      6.244106388374968388e-05,
      4.210752402756450050e-05,
      9.456306620925348863e-19,
      -3.824296593193703337e-05,
      -5.150446427586512189e-05,
      -3.466490742804570778e-05,
      4.580775718953067361e-20,
      3.135707966054841268e-05,
      4.214298584938858501e-05,
      2.830384455083175501e-05,
      3.723109069983283187e-19,
      -2.549018344208804588e-05,
      -3.417965575765894782e-05,
      -2.290168564598306724e-05,
      2.405416445549713758e-19,
      2.052453686354134316e-05,
      2.745138654185114494e-05,
      1.834550745866018732e-05,
      7.198801773919942622e-20,
      -1.635194056787656769e-05,
      -2.180845150652314335e-05,
      -1.453174003489128056e-05,
      -2.654631840756905072e-19,
      1.287335816274617411e-05,
      1.711394630143334871e-05,
      1.136578328060516862e-05,
      -5.916410273236554626e-20,
      -9.998527125737510844e-06,
      -1.324323455999509622e-05,
      -8.761612044652811006e-06,
      -7.942321131341476205e-20,
      7.645558020313557922e-06,
      1.008337698279600475e-05,
      6.641369535053029112e-06,
      1.541224364863730915e-19,
      -5.740522281215527710e-06,
      -7.532544526932845257e-06,
      -4.934949733663501931e-06,
      1.598599559041492848e-23,
      4.217029600135704248e-06,
      5.499417396809462189e-06,
      3.579570167063569281e-06,
      5.013101016070310978e-20,
      -3.015796559804429629e-06,
      -3.902572353945784810e-06,
      -2.519336937404230604e-06,
      -6.995516866208151576e-20,
      2.084208642925009633e-06,
      2.669861493776913041e-06,
      1.704804331108725262e-06,
      8.500839198448183737e-21,
      -1.375878095680522874e-06,
      -1.737786095745858642e-06,
      -1.092531618960955540e-06,
      -2.009034429250237532e-20,
      8.502003666440789634e-07,
      1.050869456967983453e-06,
      6.446398506343295995e-07,
      -2.307351317887043770e-21,
      -4.719119827183751392e-07,
      -5.610327859101661570e-07,
      -3.283715415979136751e-07,
    ]

drf_sink:
  chunk_size: &drf_chunk_size 800000
  num_subchannels: *num_subchannels
  channel_dir: isr128MHz_sr8MHz
  uuid: mep_pipeline_isr128MHz_sr8MHz
