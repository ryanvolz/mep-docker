# SPDX-FileCopyrightText: Copyright (c) 2023 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
scheduler:
  worker_thread_number: 8
  stop_on_deadlock: true
  stop_on_deadlock_timeout: 500

pipeline:
  selector: false
  converter: true
  rotator: false
  resampler0: false
  resampler1: false
  resampler2: true

packet:
  batch_size: &batch_size 6250 # Number of packets to process at once into tensor data
  max_packet_size: &max_packet_size 8256
  num_subchannels: &num_subchannels 1 # Number of IQ subchannels of data that form a sample
  num_samples: &rx_chunk_size 12800000 # Number of samples to output as a single chunk, must fit one batch of packets
  buffer_size: 10 # Number of num_samples chunks to store in the rx buffer
  spoof_header: true
  packet_skip_bytes: 0
  header_metadata:
    start_sample_idx: 0
    sample_rate_numerator: 64000000
    sample_rate_denominator: 1
    freq_idx: 0
    num_subchannels: *num_subchannels
    pkt_samples: 2048
    bits_per_int: 16
    is_complex: 1

basic_network:
  batch_size: *batch_size # Number of packets in a batch
  max_payload_size: *max_packet_size # Maximum payload size
  dst_port: 60133 # UDP destination port for packets
  l4_proto: udp # Layer 4 protocol
  ip_addr: 0.0.0.0 # Destination IP address

advanced_network:
  cfg:
    version: 1
    master_core: 1 # Master CPU core
    rx:
      - if_name: 0004:01:00.0 # PCIe BFD of NIC
        flow_isolation: true
        queues:
          - name: "RF Samples Ch0"
            id: 0
            gpu_device: 0
            gpu_direct: true
            split_boundary: 42
            cpu_cores: "2"
            max_packet_size: *max_packet_size # Maximum payload size
            num_concurrent_batches: 15 # Number of batches that can be used at any time
            batch_size: *batch_size # Number of packets in a batch
            output_port: "ch0"
        flows:
          - name: "UDP 60133 - Ch0"
            action:
              type: queue
              id: 0
            match:
              udp_src: 60133
              udp_dst: 60133

selector:
  subchannel_idx: [0]

rotator:
  cycle_duration_secs: 1
  cycle_start_timestamp: 0
  schedule:
    - start: 0
      freq: 0e+6

resampler2:
  chunk_size: *rx_chunk_size
  num_subchannels: *num_subchannels
  up: 5
  down: 16
  # scipy.signal.kaiserord(80, .1 / 5)
  # 5 * scipy.signal.firwin(495, 0.3125*.95 / 5, window=('kaiser', 7.85726))
  filter_coefs:
    [
      1.494204926144368445e-05,
      1.843872197420433023e-05,
      2.172248321940747386e-05,
      2.454100134335646753e-05,
      2.662769378519630310e-05,
      2.771496913100446018e-05,
      2.754914643996742832e-05,
      2.590643817860757340e-05,
      2.260926612655211030e-05,
      1.754208932290172857e-05,
      1.066586635697550599e-05,
      2.030256801760086457e-06,
      -8.217307414272771797e-06,
      -1.982647796689597085e-05,
      -3.244345245613670584e-05,
      -4.561555943643075668e-05,
      -5.880127957652563498e-05,
      -7.138577966313733683e-05,
      -8.270177430780151760e-05,
      -9.205525373768643253e-05,
      -9.875533701082572563e-05,
      -1.021472415355662429e-04,
      -1.016471155699903700e-04,
      -9.677727403575776160e-05,
      -8.720022239135205686e-05,
      -7.274975998583126980e-05,
      -5.345743275404967680e-05,
      -2.957266220873336189e-05,
      -1.575017205694756544e-06,
      2.982268284515181484e-05,
      6.368144332103811201e-05,
      9.885398526347684018e-05,
      1.340136553710558921e-04,
      1.676940797999583053e-04,
      1.983387801907205653e-04,
      2.243594573783541418e-04,
      2.442011511420632630e-04,
      2.564120266242407597e-04,
      2.597151431874270737e-04,
      2.530792518972509631e-04,
      2.357854637805399255e-04,
      2.074865495662811803e-04,
      1.682556856419766737e-04,
      1.186216582721109079e-04,
      5.958788081188171466e-05,
      -7.366937433891531276e-06,
      -8.030801752058990938e-05,
      -1.568844510562228736e-04,
      -2.343898545162351914e-04,
      -3.098428578028464470e-04,
      -3.800856388009386908e-04,
      -4.418978159789060944e-04,
      -4.921221591304069873e-04,
      -5.277978138597010831e-04,
      -5.462960970472039747e-04,
      -5.454534441921969103e-04,
      -5.236958066330909623e-04,
      -4.801487324959769713e-04,
      -4.147275375390701560e-04,
      -3.282023897436181698e-04,
      -2.222337936910677414e-04,
      -9.937485626251441192e-05,
      3.696217771736154108e-05,
      1.825763445719990209e-04,
      3.325851355065629895e-04,
      4.815667119820909092e-04,
      6.237339054655194164e-04,
      7.531352303339818597e-04,
      8.638767193357540152e-04,
      9.503571305881423860e-04,
      1.007508035430738479e-03,
      1.031029534076783596e-03,
      1.017611909510900484e-03,
      9.651334576566832383e-04,
      8.728250490794433420e-04,
      7.413926956122866363e-04,
      5.730905098315983289e-04,
      3.717379353869186597e-04,
      1.426769544375637328e-04,
      -1.073329084310286653e-04,
      -3.702816363974223098e-04,
      -6.371352090045261877e-04,
      -8.981164017996532464e-04,
      -1.143032310482782702e-03,
      -1.361638707780434172e-03,
      -1.544029290905734762e-03,
      -1.681036178477513920e-03,
      -1.764626755989444915e-03,
      -1.788281223535949805e-03,
      -1.747335027359178542e-03,
      -1.639270797134692852e-03,
      -1.463945480803761088e-03,
      -1.223740061146429570e-03,
      -9.236215210508649017e-04,
      -5.711095403233972271e-04,
      -1.761436744802333807e-04,
      2.491496183527494796e-04,
      6.907868953998308687e-04,
      1.133347457137306351e-03,
      1.560471884298182980e-03,
      1.955424733491307934e-03,
      2.301703461427708972e-03,
      2.583672885690404229e-03,
      2.787202380064691867e-03,
      2.900281660760343789e-03,
      2.913590538445116809e-03,
      2.820998453049087737e-03,
      2.619971004219083868e-03,
      2.311863034977036397e-03,
      1.902081077355427963e-03,
      1.400102047091839183e-03,
      8.193398644586508042e-04,
      1.768570313824999153e-04,
      -5.070760664427722587e-04,
      -1.209565440845566551e-03,
      -1.905806784972398620e-03,
      -2.569907550159633309e-03,
      -3.175792466686797912e-03,
      -3.698162728330818463e-03,
      -4.113475541995283841e-03,
      -4.400908315302784132e-03,
      -4.543270561578684023e-03,
      -4.527826747362463135e-03,
      -4.346994850437758268e-03,
      -3.998888343781000117e-03,
      -3.487673627064350693e-03,
      -2.823720492920140084e-03,
      -2.023529888225275054e-03,
      -1.109430810436994215e-03,
      -1.090464213336416540e-04,
      9.454619148298755698e-04,
      2.018355261944040132e-03,
      3.071456553387773292e-03,
      4.065435111986216363e-03,
      4.961195541006781749e-03,
      5.721324503397811137e-03,
      6.311544601228067861e-03,
      6.702121958282585348e-03,
      6.869173368463194103e-03,
      6.795820110931934804e-03,
      6.473138790427365730e-03,
      5.900864804782060893e-03,
      5.087811162772792016e-03,
      4.051974190882017511e-03,
      2.820307923415954141e-03,
      1.428160348606382843e-03,
      -8.162318920772663577e-05,
      -1.659911670757334250e-03,
      -3.252785058165501720e-03,
      -4.803274043330424056e-03,
      -6.253290260823940461e-03,
      -7.545685061963200088e-03,
      -8.626367541494431995e-03,
      -9.446407322993646133e-03,
      -9.964044925402058828e-03,
      -1.014653255230224885e-02,
      -9.971730977783928307e-03,
      -9.429393859635410921e-03,
      -8.522079200937218366e-03,
      -7.265638610389513717e-03,
      -5.689248185194507347e-03,
      -3.834959870215955482e-03,
      -1.756768563135293303e-03,
      4.807925013212183303e-04,
      2.804498034426781191e-03,
      5.134671434256726438e-03,
      7.387756616050220049e-03,
      9.479143022797438187e-03,
      1.132615356863612456e-02,
      1.285109566083166878e-02,
      1.398426902044947948e-02,
      1.466682112987563805e-02,
      1.485334201625454834e-02,
      1.451409484689339044e-02,
      1.363678744452614076e-02,
      1.222780216753149678e-02,
      1.031281734587918136e-02,
      7.936772189357853974e-03,
      5.163148241398646948e-03,
      2.072563385097468593e-03,
      -1.239301622263925444e-03,
      -4.664399906280485182e-03,
      -8.085570745199993983e-03,
      -1.138025742557879916e-02,
      -1.442458088458068929e-02,
      -1.709764251601765886e-02,
      -1.928591643537483358e-02,
      -2.088758274521029801e-02,
      -2.181664937201092253e-02,
      -2.200671116375507372e-02,
      -2.141420128321972621e-02,
      -2.002100146891693661e-02,
      -1.783629424718487580e-02,
      -1.489756127153075635e-02,
      -1.127065707570831798e-02,
      -7.048915937280441843e-03,
      -2.351280406029243944e-03,
      2.680527605251521034e-03,
      7.885739482491020344e-03,
      1.308909049482221212e-02,
      1.810607206775948982e-02,
      2.274874191796205647e-02,
      2.683192444764882778e-02,
      3.017961474758372453e-02,
      3.263138600873055628e-02,
      3.404859270650860414e-02,
      3.432016102338828617e-02,
      3.336776383477524366e-02,
      3.115019020090609159e-02,
      2.766673846149424881e-02,
      2.295948727647925333e-02,
      1.711432964021395234e-02,
      1.026069016794945929e-02,
      2.569884792074552358e-03,
      -5.747876749783008971e-03,
      -1.444780286811268508e-02,
      -2.325606155677659506e-02,
      -3.187642570400311265e-02,
      -3.999785890603863719e-02,
      -4.730284479123939012e-02,
      -5.347623455100106171e-02,
      -5.821436538226211488e-02,
      -6.123418770264267563e-02,
      -6.228213191802157989e-02,
      -6.114244658052540166e-02,
      -5.764474909602385760e-02,
      -5.167054758637065759e-02,
      -4.315851768392676979e-02,
      -3.210835028367800548e-02,
      -1.858302471649970339e-02,
      -2.709405341877471445e-03,
      1.532289308068034671e-02,
      3.526437610326636080e-02,
      5.681023055100441893e-02,
      7.960647983833285535e-02,
      1.032575898637170392e-01,
      1.273353375004918075e-01,
      1.513887145666405754e-01,
      1.749546073423823289e-01,
      1.975689662749847697e-01,
      2.187781633069384168e-01,
      2.381502258780504866e-01,
      2.552856374050312960e-01,
      2.698274039721820228e-01,
      2.814701058271173451e-01,
      2.899676795406068153e-01,
      2.951397115708849217e-01,
      2.968760654423165946e-01,
      2.951397115708849217e-01,
      2.899676795406068153e-01,
      2.814701058271173451e-01,
      2.698274039721820228e-01,
      2.552856374050312960e-01,
      2.381502258780504866e-01,
      2.187781633069384168e-01,
      1.975689662749847697e-01,
      1.749546073423823289e-01,
      1.513887145666405754e-01,
      1.273353375004918075e-01,
      1.032575898637170392e-01,
      7.960647983833285535e-02,
      5.681023055100441893e-02,
      3.526437610326636080e-02,
      1.532289308068034671e-02,
      -2.709405341877471445e-03,
      -1.858302471649970339e-02,
      -3.210835028367800548e-02,
      -4.315851768392676979e-02,
      -5.167054758637065759e-02,
      -5.764474909602385760e-02,
      -6.114244658052540166e-02,
      -6.228213191802157989e-02,
      -6.123418770264267563e-02,
      -5.821436538226211488e-02,
      -5.347623455100106171e-02,
      -4.730284479123939012e-02,
      -3.999785890603863719e-02,
      -3.187642570400311265e-02,
      -2.325606155677659506e-02,
      -1.444780286811268508e-02,
      -5.747876749783008971e-03,
      2.569884792074552358e-03,
      1.026069016794945929e-02,
      1.711432964021395234e-02,
      2.295948727647925333e-02,
      2.766673846149424881e-02,
      3.115019020090609159e-02,
      3.336776383477524366e-02,
      3.432016102338828617e-02,
      3.404859270650860414e-02,
      3.263138600873055628e-02,
      3.017961474758372453e-02,
      2.683192444764882778e-02,
      2.274874191796205647e-02,
      1.810607206775948982e-02,
      1.308909049482221212e-02,
      7.885739482491020344e-03,
      2.680527605251521034e-03,
      -2.351280406029243944e-03,
      -7.048915937280441843e-03,
      -1.127065707570831798e-02,
      -1.489756127153075635e-02,
      -1.783629424718487580e-02,
      -2.002100146891693661e-02,
      -2.141420128321972621e-02,
      -2.200671116375507372e-02,
      -2.181664937201092253e-02,
      -2.088758274521029801e-02,
      -1.928591643537483358e-02,
      -1.709764251601765886e-02,
      -1.442458088458068929e-02,
      -1.138025742557879916e-02,
      -8.085570745199993983e-03,
      -4.664399906280485182e-03,
      -1.239301622263925444e-03,
      2.072563385097468593e-03,
      5.163148241398646948e-03,
      7.936772189357853974e-03,
      1.031281734587918136e-02,
      1.222780216753149678e-02,
      1.363678744452614076e-02,
      1.451409484689339044e-02,
      1.485334201625454834e-02,
      1.466682112987563805e-02,
      1.398426902044947948e-02,
      1.285109566083166878e-02,
      1.132615356863612456e-02,
      9.479143022797438187e-03,
      7.387756616050220049e-03,
      5.134671434256726438e-03,
      2.804498034426781191e-03,
      4.807925013212183303e-04,
      -1.756768563135293303e-03,
      -3.834959870215955482e-03,
      -5.689248185194507347e-03,
      -7.265638610389513717e-03,
      -8.522079200937218366e-03,
      -9.429393859635410921e-03,
      -9.971730977783928307e-03,
      -1.014653255230224885e-02,
      -9.964044925402058828e-03,
      -9.446407322993646133e-03,
      -8.626367541494431995e-03,
      -7.545685061963200088e-03,
      -6.253290260823940461e-03,
      -4.803274043330424056e-03,
      -3.252785058165501720e-03,
      -1.659911670757334250e-03,
      -8.162318920772663577e-05,
      1.428160348606382843e-03,
      2.820307923415954141e-03,
      4.051974190882017511e-03,
      5.087811162772792016e-03,
      5.900864804782060893e-03,
      6.473138790427365730e-03,
      6.795820110931934804e-03,
      6.869173368463194103e-03,
      6.702121958282585348e-03,
      6.311544601228067861e-03,
      5.721324503397811137e-03,
      4.961195541006781749e-03,
      4.065435111986216363e-03,
      3.071456553387773292e-03,
      2.018355261944040132e-03,
      9.454619148298755698e-04,
      -1.090464213336416540e-04,
      -1.109430810436994215e-03,
      -2.023529888225275054e-03,
      -2.823720492920140084e-03,
      -3.487673627064350693e-03,
      -3.998888343781000117e-03,
      -4.346994850437758268e-03,
      -4.527826747362463135e-03,
      -4.543270561578684023e-03,
      -4.400908315302784132e-03,
      -4.113475541995283841e-03,
      -3.698162728330818463e-03,
      -3.175792466686797912e-03,
      -2.569907550159633309e-03,
      -1.905806784972398620e-03,
      -1.209565440845566551e-03,
      -5.070760664427722587e-04,
      1.768570313824999153e-04,
      8.193398644586508042e-04,
      1.400102047091839183e-03,
      1.902081077355427963e-03,
      2.311863034977036397e-03,
      2.619971004219083868e-03,
      2.820998453049087737e-03,
      2.913590538445116809e-03,
      2.900281660760343789e-03,
      2.787202380064691867e-03,
      2.583672885690404229e-03,
      2.301703461427708972e-03,
      1.955424733491307934e-03,
      1.560471884298182980e-03,
      1.133347457137306351e-03,
      6.907868953998308687e-04,
      2.491496183527494796e-04,
      -1.761436744802333807e-04,
      -5.711095403233972271e-04,
      -9.236215210508649017e-04,
      -1.223740061146429570e-03,
      -1.463945480803761088e-03,
      -1.639270797134692852e-03,
      -1.747335027359178542e-03,
      -1.788281223535949805e-03,
      -1.764626755989444915e-03,
      -1.681036178477513920e-03,
      -1.544029290905734762e-03,
      -1.361638707780434172e-03,
      -1.143032310482782702e-03,
      -8.981164017996532464e-04,
      -6.371352090045261877e-04,
      -3.702816363974223098e-04,
      -1.073329084310286653e-04,
      1.426769544375637328e-04,
      3.717379353869186597e-04,
      5.730905098315983289e-04,
      7.413926956122866363e-04,
      8.728250490794433420e-04,
      9.651334576566832383e-04,
      1.017611909510900484e-03,
      1.031029534076783596e-03,
      1.007508035430738479e-03,
      9.503571305881423860e-04,
      8.638767193357540152e-04,
      7.531352303339818597e-04,
      6.237339054655194164e-04,
      4.815667119820909092e-04,
      3.325851355065629895e-04,
      1.825763445719990209e-04,
      3.696217771736154108e-05,
      -9.937485626251441192e-05,
      -2.222337936910677414e-04,
      -3.282023897436181698e-04,
      -4.147275375390701560e-04,
      -4.801487324959769713e-04,
      -5.236958066330909623e-04,
      -5.454534441921969103e-04,
      -5.462960970472039747e-04,
      -5.277978138597010831e-04,
      -4.921221591304069873e-04,
      -4.418978159789060944e-04,
      -3.800856388009386908e-04,
      -3.098428578028464470e-04,
      -2.343898545162351914e-04,
      -1.568844510562228736e-04,
      -8.030801752058990938e-05,
      -7.366937433891531276e-06,
      5.958788081188171466e-05,
      1.186216582721109079e-04,
      1.682556856419766737e-04,
      2.074865495662811803e-04,
      2.357854637805399255e-04,
      2.530792518972509631e-04,
      2.597151431874270737e-04,
      2.564120266242407597e-04,
      2.442011511420632630e-04,
      2.243594573783541418e-04,
      1.983387801907205653e-04,
      1.676940797999583053e-04,
      1.340136553710558921e-04,
      9.885398526347684018e-05,
      6.368144332103811201e-05,
      2.982268284515181484e-05,
      -1.575017205694756544e-06,
      -2.957266220873336189e-05,
      -5.345743275404967680e-05,
      -7.274975998583126980e-05,
      -8.720022239135205686e-05,
      -9.677727403575776160e-05,
      -1.016471155699903700e-04,
      -1.021472415355662429e-04,
      -9.875533701082572563e-05,
      -9.205525373768643253e-05,
      -8.270177430780151760e-05,
      -7.138577966313733683e-05,
      -5.880127957652563498e-05,
      -4.561555943643075668e-05,
      -3.244345245613670584e-05,
      -1.982647796689597085e-05,
      -8.217307414272771797e-06,
      2.030256801760086457e-06,
      1.066586635697550599e-05,
      1.754208932290172857e-05,
      2.260926612655211030e-05,
      2.590643817860757340e-05,
      2.754914643996742832e-05,
      2.771496913100446018e-05,
      2.662769378519630310e-05,
      2.454100134335646753e-05,
      2.172248321940747386e-05,
      1.843872197420433023e-05,
      1.494204926144368445e-05,
    ]

drf_sink:
  chunk_size: &drf_chunk_size 4000000
  num_subchannels: *num_subchannels
  channel_dir: sr20MHz
  uuid: mep_pipeline_sr20MHz
