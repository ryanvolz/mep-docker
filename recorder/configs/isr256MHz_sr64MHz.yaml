# SPDX-FileCopyrightText: Copyright (c) 2023 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
scheduler:
  worker_thread_number: 8
  stop_on_deadlock: true
  stop_on_deadlock_timeout: 500

pipeline:
  selector: false
  converter: true
  rotator: false
  resampler0: true
  resampler1: false
  resampler2: true

packet:
  batch_size: &batch_size 6250 # Number of packets to process at once into tensor data
  max_packet_size: &max_packet_size 8256
  num_subchannels: &num_subchannels 1 # Number of IQ subchannels of data that form a sample
  num_samples: &rx_chunk_size 12800000 # Number of samples to output as a single chunk, must fit one batch of packets
  buffer_size: 10 # Number of num_samples chunks to store in the rx buffer
  spoof_header: true
  packet_skip_bytes: 0
  header_metadata:
    start_sample_idx: 0
    sample_rate_numerator: 256000000
    sample_rate_denominator: 1
    freq_idx: 0
    num_subchannels: *num_subchannels
    pkt_samples: 2048
    bits_per_int: 16
    is_complex: 1

basic_network:
  batch_size: *batch_size # Number of packets in a batch
  max_payload_size: *max_packet_size # Maximum payload size
  dst_port: 60133 # UDP destination port for packets
  l4_proto: udp # Layer 4 protocol
  ip_addr: 0.0.0.0 # Destination IP address

advanced_network:
  cfg:
    version: 1
    master_core: 1 # Master CPU core
    rx:
      - if_name: 0004:01:00.0 # PCIe BFD of NIC
        flow_isolation: true
        queues:
          - name: "RF Samples Ch0"
            id: 0
            gpu_device: 0
            gpu_direct: true
            split_boundary: 42
            cpu_cores: "2"
            max_packet_size: *max_packet_size # Maximum payload size
            num_concurrent_batches: 15 # Number of batches that can be used at any time
            batch_size: *batch_size # Number of packets in a batch
            output_port: "ch0"
        flows:
          - name: "UDP 60133 - Ch0"
            action:
              type: queue
              id: 0
            match:
              udp_src: 60133
              udp_dst: 60133

selector:
  subchannel_idx: [0]

rotator:
  cycle_duration_secs: 1
  cycle_start_timestamp: 0
  schedule:
    - start: 0
      freq: 0e+6

resampler0:
  chunk_size: *rx_chunk_size
  num_subchannels: *num_subchannels
  up: 1
  down: 2
  # scipy.signal.kaiserord(100, .2)
  # scipy.signal.firwin(63, 1/2, window=('kaiser', 10.06126))
  filter_coefs:
    [
      -3.440782045348093414e-06,
      6.475134930461779067e-20,
      2.843290666698351405e-05,
      -9.731626069089269993e-20,
      -1.023187991772497190e-04,
      -3.370088613149795566e-19,
      2.738798304056876110e-04,
      -6.151029067545495241e-19,
      -6.181751601540667624e-04,
      4.346913133459958802e-18,
      1.242261885092403161e-03,
      -2.085278446652719769e-18,
      -2.290638669090548814e-03,
      3.340602116706095638e-18,
      3.951961434508053164e-03,
      -4.983149825753155694e-18,
      -6.471495069511502309e-03,
      6.988031690948781184e-18,
      1.018001473603221546e-02,
      -9.275024754176464020e-18,
      -1.556512793538530545e-02,
      1.170887785504900664e-17,
      2.345514845416764999e-02,
      -1.410972444910063221e-17,
      -3.554168809468621903e-02,
      1.627298805290497133e-17,
      5.618379254669078615e-02,
      -1.799602024560556726e-17,
      -1.014540170603019792e-01,
      1.910700319534701126e-17,
      3.167317784745882214e-01,
      4.999992626044002519e-01,
      3.167317784745882214e-01,
      1.910700319534701126e-17,
      -1.014540170603019792e-01,
      -1.799602024560556726e-17,
      5.618379254669078615e-02,
      1.627298805290497133e-17,
      -3.554168809468621903e-02,
      -1.410972444910063221e-17,
      2.345514845416764999e-02,
      1.170887785504900664e-17,
      -1.556512793538530545e-02,
      -9.275024754176464020e-18,
      1.018001473603221546e-02,
      6.988031690948781184e-18,
      -6.471495069511502309e-03,
      -4.983149825753155694e-18,
      3.951961434508053164e-03,
      3.340602116706095638e-18,
      -2.290638669090548814e-03,
      -2.085278446652719769e-18,
      1.242261885092403161e-03,
      4.346913133459958802e-18,
      -6.181751601540667624e-04,
      -6.151029067545495241e-19,
      2.738798304056876110e-04,
      -3.370088613149795566e-19,
      -1.023187991772497190e-04,
      -9.731626069089269993e-20,
      2.843290666698351405e-05,
      6.475134930461779067e-20,
      -3.440782045348093414e-06,
    ]

resampler2:
  chunk_size: 6400000
  num_subchannels: *num_subchannels
  up: 1
  down: 2
  # scipy.signal.kaiserord(99, .025)
  # scipy.signal.firwin(511, 1/2, window=('kaiser', 9.95106))
  filter_coefs:
    [
      -4.643872544514290509e-07,
      2.746183032453378585e-21,
      6.673839911062192116e-07,
      4.614700318684776475e-21,
      -9.116579618602395283e-07,
      4.222084582126772010e-20,
      1.202364285522967943e-06,
      -4.018066840987075929e-20,
      -1.545072257059053958e-06,
      3.235038260074274105e-20,
      1.945784486084726923e-06,
      -1.700166986018005095e-20,
      -2.410956195680018695e-06,
      -7.863651575298080492e-21,
      2.947514649661815890e-06,
      -1.399102670737541204e-19,
      -3.562878676105832909e-06,
      1.261968931833166991e-19,
      4.264978254743400932e-06,
      -1.002619699788221119e-19,
      -5.062274135906577343e-06,
      5.925978860644407907e-20,
      5.963777458965661335e-06,
      3.197197512736663631e-23,
      -6.979069338712703864e-06,
      -8.124265178632466062e-20,
      8.118320388906496887e-06,
      -3.082447181998481968e-19,
      -9.392310153226156671e-06,
      2.470088313964485585e-19,
      1.081244641519545999e-05,
      -1.588463428684188375e-19,
      -1.239078436025695426e-05,
      3.887468020027918119e-20,
      1.414004556510843562e-05,
      1.183281460509309661e-19,
      -1.607363679168410435e-05,
      6.540544106472013143e-19,
      1.820566856578566565e-05,
      -5.309261015678306682e-19,
      -2.055097352336428010e-05,
      3.632508601391399209e-19,
      2.312512451084301808e-05,
      -1.439759631865614004e-19,
      -2.594445242967299782e-05,
      -1.346428618041183948e-19,
      2.902606381955623717e-05,
      4.810830475531113199e-19,
      -3.238785817947146232e-05,
      1.038289593400195193e-18,
      3.604854503082785419e-05,
      -7.446214401144410417e-19,
      -4.002766073277857058e-05,
      3.715416056948096464e-19,
      4.434558506597893691e-05,
      9.161546837797615650e-20,
      -4.902355760790908683e-05,
      -6.564236782272571829e-19,
      5.408369393033006506e-05,
      -1.891260374563448294e-18,
      -5.954900165755509014e-05,
      1.407246974242248812e-18,
      6.544339643302959550e-05,
      -8.060240474532918299e-19,
      -7.179171785127931886e-05,
      7.334092828945499696e-20,
      7.861974542266258841e-05,
      8.061536662314421443e-19,
      -8.595421464960852325e-05,
      3.256711971494906861e-18,
      9.382283330520772532e-05,
      -2.495948689721818999e-18,
      -1.022542980182322171e-04,
      1.568027877731104173e-18,
      1.112783112829655369e-04,
      -4.543881783965895981e-19,
      -1.209255990277495214e-04,
      -8.648416660761225457e-19,
      1.312279288929807451e-04,
      -5.355898984181132358e-18,
      -1.422181293875764173e-04,
      4.205344287993369136e-18,
      1.539301101127871186e-04,
      -2.823175818906899173e-18,
      -1.663988832638579700e-04,
      1.185732126086276190e-18,
      1.796605866435814752e-04,
      7.321866572791153280e-19,
      -1.937525084474983757e-04,
      -2.957380521797301134e-18,
      2.087131141085625974e-04,
      -6.790079037650840365e-18,
      -2.245820755198487827e-04,
      4.791946106466833069e-18,
      2.414003029875809198e-04,
      -2.451042620750958744e-18,
      -2.592099803038034017e-04,
      -2.640514604651258142e-19,
      2.780546033687951034e-04,
      -4.795393757234994157e-18,
      -2.979790228383087463e-04,
      1.812255535732253325e-18,
      3.190294913204418754e-04,
      -7.760804413833408633e-18,
      -3.412537157020456091e-04,
      4.494084210357739835e-18,
      3.647009152457193022e-04,
      -7.375757581496993072e-19,
      -3.894218861665216030e-04,
      7.883837283153520727e-18,
      4.154690734734058154e-04,
      -3.782749500491751170e-18,
      -4.428966509452440738e-04,
      -8.974446416822425469e-19,
      4.717606102063277916e-04,
      -7.631232840173921704e-18,
      -5.021188599729692120e-04,
      2.536224488020934544e-18,
      5.340313366629333407e-04,
      3.239260566471980010e-18,
      -5.675601276949378965e-04,
      6.877760558970660385e-18,
      6.027696089586201443e-04,
      -6.068917931173251692e-19,
      -6.397265981090600757e-04,
      1.226729250532623708e-17,
      6.785005255371274460e-04,
      -5.475376628814282117e-18,
      -7.191636250915495795e-04,
      -2.178389037421691146e-18,
      7.617911468848917803e-04,
      -1.152144812313946693e-17,
      -8.064615948089568246e-04,
      3.250021904722371421e-18,
      8.532569917214166211e-04,
      -1.891732070146371401e-17,
      -9.022631756521835985e-04,
      9.998043907050784785e-18,
      9.535701308237126955e-04,
      2.426690662736139544e-21,
      -1.007272357794355803e-03,
      1.825690694751288231e-17,
      1.063469287630436442e-03,
      -7.492634631197813534e-18,
      -1.122265745705587885e-03,
      -4.521456870863909288e-18,
      1.183772471532788979e-03,
      -1.667593874110509250e-17,
      -1.248106701976898396e-03,
      3.764563263771277917e-18,
      1.315392826299093248e-03,
      1.058907525722227764e-17,
      -1.385763122780865912e-03,
      1.393479774306247672e-17,
      1.459358588202304147e-03,
      1.470748551186550829e-18,
      -1.536329873254085703e-03,
      2.625663208699580476e-17,
      1.616838339102003854e-03,
      -9.749007524986914649e-18,
      -1.701057252867745799e-03,
      -8.552632210862658654e-18,
      1.789173142827168734e-03,
      -2.337257857346041967e-17,
      -1.881387337765665470e-03,
      3.777555104521071118e-18,
      1.977917719304932501e-03,
      -3.974492354734448752e-17,
      -2.079000721295294445e-03,
      1.879553994641668809e-17,
      2.184893616766201731e-03,
      4.394151475888377719e-18,
      -2.295877140714142148e-03,
      3.689898560359856432e-17,
      2.412258506524439169e-03,
      -1.211213633706514992e-17,
      -2.534374885510306402e-03,
      2.163580313219819195e-17,
      2.662597433471504838e-03,
      -3.209201261659854368e-17,
      -2.797335966055938122e-03,
      2.805583138447527228e-18,
      2.939044406997978753e-03,
      -1.328203432846222851e-17,
      -3.088227161250279001e-03,
      2.481659296670187582e-17,
      3.245446600259092353e-03,
      9.787573183187772090e-18,
      -3.411331891333429026e-03,
      1.709069175882416888e-18,
      3.586589460138721232e-03,
      -1.441351577215030596e-17,
      -3.772015448735763481e-03,
      2.843240687422487492e-17,
      3.968510626633874744e-03,
      -4.388521643809847934e-17,
      -4.177098336374499184e-03,
      -5.306255399627161713e-21,
      4.398946218383707751e-03,
      -1.548285396828807239e-17,
      -4.635392676473921482e-03,
      3.264708134435466650e-17,
      4.887979335596159131e-03,
      1.968857568230688049e-17,
      -5.158491136097675955e-03,
      -2.603355231442772353e-18,
      5.449006245635975264e-03,
      -1.646662950465235507e-17,
      -5.761958712418694534e-03,
      3.775606585967859021e-17,
      6.100217822966825555e-03,
      -6.154060296819451868e-17,
      -6.467189602281076498e-03,
      -6.535797234832281437e-18,
      6.866948016397747198e-03,
      -1.734251511210967202e-17,
      -7.304406538863124528e-03,
      4.432641723747837058e-17,
      7.785545353061014938e-03,
      -1.773351148526991022e-17,
      -8.317716443800993523e-03,
      -1.265740134177306086e-17,
      8.910059621128736673e-03,
      -1.809004823388286757e-17,
      -9.574079573778352184e-03,
      5.355946762656813967e-17,
      1.032446168967526140e-02,
      -1.840997810312290027e-17,
      -1.118025044755004485e-02,
      -2.285208964275540331e-17,
      1.216659341836735103e-02,
      -1.869135702424145832e-17,
      -1.331739515964532050e-02,
      6.844290092474789499e-17,
      1.467948759671832380e-02,
      -1.893246196698749929e-17,
      -1.631943430111564008e-02,
      1.903743765080840922e-17,
      1.833513775648030336e-02,
      -1.913180686205029711e-17,
      -2.087673239900908473e-02,
      1.921542313261097538e-17,
      2.418676349580860599e-02,
      -1.928815640656146187e-17,
      -2.868419747147278945e-02,
      1.934989334461468236e-17,
      3.516044593392976536e-02,
      -1.940053758985501065e-17,
      -4.531143079612132835e-02,
      1.944000999393915962e-17,
      6.354660555945491895e-02,
      -1.946824880309581149e-17,
      -1.060340615106293294e-01,
      1.948520980336979097e-17,
      3.182869076109984818e-01,
      5.000001862945480102e-01,
      3.182869076109984818e-01,
      1.948520980336979097e-17,
      -1.060340615106293294e-01,
      -1.946824880309581149e-17,
      6.354660555945491895e-02,
      1.944000999393915962e-17,
      -4.531143079612132835e-02,
      -1.940053758985501065e-17,
      3.516044593392976536e-02,
      1.934989334461468236e-17,
      -2.868419747147278945e-02,
      -1.928815640656146187e-17,
      2.418676349580860599e-02,
      1.921542313261097538e-17,
      -2.087673239900908473e-02,
      -1.913180686205029711e-17,
      1.833513775648030336e-02,
      1.903743765080840922e-17,
      -1.631943430111564008e-02,
      -1.893246196698749929e-17,
      1.467948759671832380e-02,
      6.844290092474789499e-17,
      -1.331739515964532050e-02,
      -1.869135702424145832e-17,
      1.216659341836735103e-02,
      -2.285208964275540331e-17,
      -1.118025044755004485e-02,
      -1.840997810312290027e-17,
      1.032446168967526140e-02,
      5.355946762656813967e-17,
      -9.574079573778352184e-03,
      -1.809004823388286757e-17,
      8.910059621128736673e-03,
      -1.265740134177306086e-17,
      -8.317716443800993523e-03,
      -1.773351148526991022e-17,
      7.785545353061014938e-03,
      4.432641723747837058e-17,
      -7.304406538863124528e-03,
      -1.734251511210967202e-17,
      6.866948016397747198e-03,
      -6.535797234832281437e-18,
      -6.467189602281076498e-03,
      -6.154060296819451868e-17,
      6.100217822966825555e-03,
      3.775606585967859021e-17,
      -5.761958712418694534e-03,
      -1.646662950465235507e-17,
      5.449006245635975264e-03,
      -2.603355231442772353e-18,
      -5.158491136097675955e-03,
      1.968857568230688049e-17,
      4.887979335596159131e-03,
      3.264708134435466650e-17,
      -4.635392676473921482e-03,
      -1.548285396828807239e-17,
      4.398946218383707751e-03,
      -5.306255399627161713e-21,
      -4.177098336374499184e-03,
      -4.388521643809847934e-17,
      3.968510626633874744e-03,
      2.843240687422487492e-17,
      -3.772015448735763481e-03,
      -1.441351577215030596e-17,
      3.586589460138721232e-03,
      1.709069175882416888e-18,
      -3.411331891333429026e-03,
      9.787573183187772090e-18,
      3.245446600259092353e-03,
      2.481659296670187582e-17,
      -3.088227161250279001e-03,
      -1.328203432846222851e-17,
      2.939044406997978753e-03,
      2.805583138447527228e-18,
      -2.797335966055938122e-03,
      -3.209201261659854368e-17,
      2.662597433471504838e-03,
      2.163580313219819195e-17,
      -2.534374885510306402e-03,
      -1.211213633706514992e-17,
      2.412258506524439169e-03,
      3.689898560359856432e-17,
      -2.295877140714142148e-03,
      4.394151475888377719e-18,
      2.184893616766201731e-03,
      1.879553994641668809e-17,
      -2.079000721295294445e-03,
      -3.974492354734448752e-17,
      1.977917719304932501e-03,
      3.777555104521071118e-18,
      -1.881387337765665470e-03,
      -2.337257857346041967e-17,
      1.789173142827168734e-03,
      -8.552632210862658654e-18,
      -1.701057252867745799e-03,
      -9.749007524986914649e-18,
      1.616838339102003854e-03,
      2.625663208699580476e-17,
      -1.536329873254085703e-03,
      1.470748551186550829e-18,
      1.459358588202304147e-03,
      1.393479774306247672e-17,
      -1.385763122780865912e-03,
      1.058907525722227764e-17,
      1.315392826299093248e-03,
      3.764563263771277917e-18,
      -1.248106701976898396e-03,
      -1.667593874110509250e-17,
      1.183772471532788979e-03,
      -4.521456870863909288e-18,
      -1.122265745705587885e-03,
      -7.492634631197813534e-18,
      1.063469287630436442e-03,
      1.825690694751288231e-17,
      -1.007272357794355803e-03,
      2.426690662736139544e-21,
      9.535701308237126955e-04,
      9.998043907050784785e-18,
      -9.022631756521835985e-04,
      -1.891732070146371401e-17,
      8.532569917214166211e-04,
      3.250021904722371421e-18,
      -8.064615948089568246e-04,
      -1.152144812313946693e-17,
      7.617911468848917803e-04,
      -2.178389037421691146e-18,
      -7.191636250915495795e-04,
      -5.475376628814282117e-18,
      6.785005255371274460e-04,
      1.226729250532623708e-17,
      -6.397265981090600757e-04,
      -6.068917931173251692e-19,
      6.027696089586201443e-04,
      6.877760558970660385e-18,
      -5.675601276949378965e-04,
      3.239260566471980010e-18,
      5.340313366629333407e-04,
      2.536224488020934544e-18,
      -5.021188599729692120e-04,
      -7.631232840173921704e-18,
      4.717606102063277916e-04,
      -8.974446416822425469e-19,
      -4.428966509452440738e-04,
      -3.782749500491751170e-18,
      4.154690734734058154e-04,
      7.883837283153520727e-18,
      -3.894218861665216030e-04,
      -7.375757581496993072e-19,
      3.647009152457193022e-04,
      4.494084210357739835e-18,
      -3.412537157020456091e-04,
      -7.760804413833408633e-18,
      3.190294913204418754e-04,
      1.812255535732253325e-18,
      -2.979790228383087463e-04,
      -4.795393757234994157e-18,
      2.780546033687951034e-04,
      -2.640514604651258142e-19,
      -2.592099803038034017e-04,
      -2.451042620750958744e-18,
      2.414003029875809198e-04,
      4.791946106466833069e-18,
      -2.245820755198487827e-04,
      -6.790079037650840365e-18,
      2.087131141085625974e-04,
      -2.957380521797301134e-18,
      -1.937525084474983757e-04,
      7.321866572791153280e-19,
      1.796605866435814752e-04,
      1.185732126086276190e-18,
      -1.663988832638579700e-04,
      -2.823175818906899173e-18,
      1.539301101127871186e-04,
      4.205344287993369136e-18,
      -1.422181293875764173e-04,
      -5.355898984181132358e-18,
      1.312279288929807451e-04,
      -8.648416660761225457e-19,
      -1.209255990277495214e-04,
      -4.543881783965895981e-19,
      1.112783112829655369e-04,
      1.568027877731104173e-18,
      -1.022542980182322171e-04,
      -2.495948689721818999e-18,
      9.382283330520772532e-05,
      3.256711971494906861e-18,
      -8.595421464960852325e-05,
      8.061536662314421443e-19,
      7.861974542266258841e-05,
      7.334092828945499696e-20,
      -7.179171785127931886e-05,
      -8.060240474532918299e-19,
      6.544339643302959550e-05,
      1.407246974242248812e-18,
      -5.954900165755509014e-05,
      -1.891260374563448294e-18,
      5.408369393033006506e-05,
      -6.564236782272571829e-19,
      -4.902355760790908683e-05,
      9.161546837797615650e-20,
      4.434558506597893691e-05,
      3.715416056948096464e-19,
      -4.002766073277857058e-05,
      -7.446214401144410417e-19,
      3.604854503082785419e-05,
      1.038289593400195193e-18,
      -3.238785817947146232e-05,
      4.810830475531113199e-19,
      2.902606381955623717e-05,
      -1.346428618041183948e-19,
      -2.594445242967299782e-05,
      -1.439759631865614004e-19,
      2.312512451084301808e-05,
      3.632508601391399209e-19,
      -2.055097352336428010e-05,
      -5.309261015678306682e-19,
      1.820566856578566565e-05,
      6.540544106472013143e-19,
      -1.607363679168410435e-05,
      1.183281460509309661e-19,
      1.414004556510843562e-05,
      3.887468020027918119e-20,
      -1.239078436025695426e-05,
      -1.588463428684188375e-19,
      1.081244641519545999e-05,
      2.470088313964485585e-19,
      -9.392310153226156671e-06,
      -3.082447181998481968e-19,
      8.118320388906496887e-06,
      -8.124265178632466062e-20,
      -6.979069338712703864e-06,
      3.197197512736663631e-23,
      5.963777458965661335e-06,
      5.925978860644407907e-20,
      -5.062274135906577343e-06,
      -1.002619699788221119e-19,
      4.264978254743400932e-06,
      1.261968931833166991e-19,
      -3.562878676105832909e-06,
      -1.399102670737541204e-19,
      2.947514649661815890e-06,
      -7.863651575298080492e-21,
      -2.410956195680018695e-06,
      -1.700166986018005095e-20,
      1.945784486084726923e-06,
      3.235038260074274105e-20,
      -1.545072257059053958e-06,
      -4.018066840987075929e-20,
      1.202364285522967943e-06,
      4.222084582126772010e-20,
      -9.116579618602395283e-07,
      4.614700318684776475e-21,
      6.673839911062192116e-07,
      2.746183032453378585e-21,
      -4.643872544514290509e-07,
    ]

drf_sink:
  chunk_size: &drf_chunk_size 3200000
  num_subchannels: *num_subchannels
  channel_dir: isr256MHz_sr64MHz
  uuid: mep_pipeline_isr256MHz_sr64MHz
